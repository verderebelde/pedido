<script>
function enviarPedido(){
  if(enviando) return;

  const btn = document.getElementById("btnEnviar");
  btn.disabled = true;
  btn.innerText = "ENVIANDO...";
  enviando = true;

  const nombre = nombreEl().value.trim();
  const movil = movilEl().value.trim();
  const obs = document.getElementById("observaciones").value.trim();

  if(!nombre){
    alert("Nombre obligatorio");
    resetBoton();
    return;
  }
  if(!movil){
    alert("TelÃ©fono obligatorio");
    resetBoton();
    return;
  }

  let resumen = "";
  let total = 0;

  for(let i in carrito){
    if(carrito[i] > 0){
      resumen += `${carrito[i]} x ${productos[i].nombre}\n`;
      total += carrito[i] * productos[i].precio;
    }
  }

  if(total === 0){
    alert("AÃ±ade al menos un producto");
    resetBoton();
    return;
  }

  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({nombre,movil,pedido:resumen,total,observaciones:obs})
  })
  .then(r => r.json())
  .then(() => {

    // ðŸ”µ PANTALLA FINAL LIMPIA
    document.body.innerHTML = `
      <div style="font-family:Segoe UI,Arial;padding:30px">
        <h1>âœ… Pedido enviado</h1>
        <p><strong>Nombre:</strong> ${nombre}</p>
        <p><strong>TelÃ©fono:</strong> ${movil}</p>
        <pre style="background:#f4f4f4;padding:15px;border-radius:10px">${resumen}</pre>
        <p><strong>Observaciones:</strong> ${obs || "-"}</p>
        <h2>Total: â‚¬${total.toFixed(2)}</h2>
      </div>
    `;

  })
  .catch(err=>{
    alert("Error enviando pedido");
    console.error(err);
    resetBoton();
  });
}

function resetBoton(){
  const btn = document.getElementById("btnEnviar");
  btn.disabled = false;
  btn.innerText = "ENVIAR PEDIDO";
  enviando = false;
}
</script>