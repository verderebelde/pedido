<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Hacer Pedido</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
        .producto { border-bottom: 1px solid #ccc; padding: 10px 0; display: flex; justify-content: space-between; align-items: center; }
        input[type="number"] { width: 60px; }
        #total-flotante { position: fixed; bottom: 0; left:0; right:0; background: #333; color: white; padding: 15px; text-align: center; font-size: 1.2em; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="pantalla-pedido">
    <h1>Realiza tu Pedido</h1>
    <input type="text" id="nombreCli" placeholder="Tu Nombre" required>
    <input type="tel" id="telefonoCli" placeholder="Tu Teléfono" required>
    
    <div id="lista-productos">Cargando productos...</div>
    <div style="height: 80px;"></div> <div id="total-flotante">
        Total: $<span id="suma-total">0.00</span>
        <button onclick="enviarPedido()" style="margin-left:20px; padding: 10px;">ENVIAR PEDIDO</button>
    </div>
</div>

<div id="pantalla-gracias" class="hidden">
    <h1>¡GRACIAS POR TU PEDIDO!</h1>
    <h3>Resumen:</h3>
    <div id="resumen-final"></div>
    <button onclick="location.reload()">Nuevo Pedido</button>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwdQsPAPbOUmlxw-L7N-_gjRVG3Yl451xGmYrLa1rLxxMUoNVYphOxWbQ6kvfb_6q2OoA/exec"; // Pega aquí tu URL
let productosData = [];

// Cargar productos
fetch(SCRIPT_URL)
    .then(res => res.json())
    .then(data => {
        productosData = data.slice(1); // Quitar cabecera
        let html = '';
        productosData.forEach((prod, index) => {
            // Estructura: NOMBRE (0), FORMATO (1), PRECIO (2), CATEGORIA (3), MINIMO (4), SALTO (5)
            html += `
            <div class="producto">
                <div>
                    <strong>${prod[0]}</strong> (${prod[1]}) - $${prod[2]}<br>
                    <small>${prod[3]}</small>
                </div>
                <div>
                    Cant: <input type="number" id="cant-${index}" 
                           value="0" min="${prod[4] || 0}" step="${prod[5] || 1}" 
                           onchange="recalcularTotal()">
                </div>
            </div>`;
        });
        document.getElementById('lista-productos').innerHTML = html;
    });

function recalcularTotal() {
    let total = 0;
    productosData.forEach((prod, index) => {
        let cant = parseFloat(document.getElementById(`cant-${index}`).value);
        if(cant > 0) total += cant * prod[2];
    });
    document.getElementById('suma-total').innerText = total.toFixed(2);
}

function enviarPedido() {
    const nombre = document.getElementById('nombreCli').value;
    const telefono = document.getElementById('telefonoCli').value;
    if(!nombre || !telefono) return alert("Pon tu nombre y teléfono");

    let resumen = "";
    let total = 0;

    productosData.forEach((prod, index) => {
        let cant = parseFloat(document.getElementById(`cant-${index}`).value);
        if(cant > 0) {
            resumen += `${prod[0]} x ${cant} (${prod[1]})\n`;
            total += cant * prod[2];
        }
    });

    if(total === 0) return alert("No has seleccionado nada");

    const datos = { nombre, telefono, resumen, total };

    fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify(datos)
    }).then(() => {
        document.getElementById('pantalla-pedido').classList.add('hidden');
        document.getElementById('pantalla-gracias').classList.remove('hidden');
        document.getElementById('resumen-final').innerText = `${nombre}\n${resumen}\nTOTAL: $${total}`;
    });
}
</script>
</body>
</html>